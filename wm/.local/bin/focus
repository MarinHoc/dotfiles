#!/bin/sh
#
# focus - focus closest window from the focused window in a given direction

# exit when fullscreen
bspc query -N -n focused.fullscreen > /dev/null && exit

case $1 in
    east)  arg=xyi; sign=-gt;;
    west)  arg=xyi; sign=-lt;;
    north) arg=yxi; sign=-lt;;
    south) arg=yxi; sign=-gt
esac

# get coordinates of all windows on the focused desktop
wattr "$arg" "$(targets focused)" $(targets normal) | {
    read -r cur_1 cur_2 _

    # sort the coordinates to find the closest window
    while read -r win_1 win_2 win_3; do
        [ "$win_1" "$sign" "$cur_1" ] && {
            win_1=$((win_1 - cur_1))
            win_2=$((win_2 - cur_2))

            # absolute values
            win_1=${win_1#-}
            win_2=${win_2#-}

            [ \
                $((
                    !min_1 || win_1 < min_1 ||
                    win_1 == min_1 && win_2 < min_2
                 )) -eq 1 \
            ] && {
                min_1=$win_1
                min_2=$win_2
                focus=$win_3
            }
        }
    done

    bspc node "$focus" -f && cursor
}
