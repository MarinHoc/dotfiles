#!/bin/sh
#
# focus window

# exit when fullscreen
bspc query -N -n focused.fullscreen > /dev/null && exit

case $1 in
    east)  arg=xy; op=-gt;;
    west)  arg=xy; op=-lt;;
    north) arg=yx; op=-lt;;
    south) arg=yx; op=-gt
esac

# get the coordinates of all windows on the current desktop
wattr "i$arg" "$(targets focused)" $(targets normal) | {
    read -r _ cur_1 cur_2

    # sort the coordinates to find the closest window
    while read -r win_1 win_2 win_3; do
        [ "$win_2" "$op" "$cur_1" ] && {
            win_2=$((win_2 - cur_1)); win_2=${win_2#-}
            win_3=$((win_3 - cur_2)); win_3=${win_3#-}

            [ \
                $((
                    ! min_1 || win_2 < min_1 ||
                    win_2 == min_1 && win_3 < min_2
                 )) -eq 1 \
            ] && {
                focus=$win_1
                min_1=$win_2
                min_2=$win_3
            }
        }
    done

    bspc node "$focus" -f && cursor
}
