#!/bin/sh
#
# player control

# send a notification when fullscreen & changing playing file
bspc query -N -n focused.fullscreen > /dev/null && test "$1" != toggle &&
    notify=1

pgrep -x mpv > /dev/null && {
    socket=/tmp/mpv-socket

    case $1 in
        toggle)    echo "cycle pause" | socat - "$socket";;
        next|prev) echo "playlist-$1" | socat - "$socket"
    esac

    if "$notify"; then
        echo '{ "command": [ "get_property", "filtered-metadata" ] }' |
            socat - "$socket" | {
                read -r out

                # parse output
                out=${out#*\"Title\":\"}
                out=${out%\"\},\"request*}

                dunstify -r 550 "$out"
            }
    fi
} || mpc "$1" 2> /dev/null | {
    read -r out

    test "$notify" &&
        dunstify -r 550 "$out"
}
