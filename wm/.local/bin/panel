#!/bin/sh
#
# panel - main panel script

NAME=panel

cleanup() {
    bspc config top_padding 0

    trap - TERM; kill 0
}

. ~/.config/lemonbar/config

# ensure proper panel script cleanup
trap cleanup INT TERM QUIT EXIT

# run all panel modules
for mod in ~/.config/lemonbar/lemons/*; do
    "$mod" &
done |
    while read -r event; do
        # parse events
        export "${event%% *}=${event#* }"

        eval "printf '%s\n' \"$format\""
    done |
        lemonbar             \
            -g "x$height"    \
            -F "$foreground" \
            -B "$background" \
            -f "$icons"      \
            -f "$font"       \
            -n "$NAME" &

# ensure proper fullscreen
xdo lower -ma "$NAME"

wait
